<!DOCTYPE html>
<html>
<head>
    <title>Manual Task Regeneration</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .container { max-width: 600px; margin: 0 auto; }
        button { padding: 10px 20px; margin: 10px; background: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #45a049; }
        .result { margin-top: 20px; padding: 10px; background: #f0f0f0; border-radius: 4px; }
        .error { background: #ffebee; color: #c62828; }
        .success { background: #e8f5e8; color: #2e7d32; }
        .info { background: #e3f2fd; color: #1565c0; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üçì Manual Task Regeneration for Strawberry Plants</h1>
        
        <p>This page will help you regenerate fertilization tasks for your existing strawberry plants.</p>
        
        <div>
            <button onclick="checkAuth()">1. Check Firebase Auth</button>
            <button onclick="listStrawberryPlants()">2. List Strawberry Plants</button>
            <button onclick="regenerateAllStrawberryTasks()">3. Regenerate All Strawberry Tasks</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
        
        <h3>Instructions:</h3>
        <ol>
            <li>Open your SmartGarden app in another tab and make sure you're logged in</li>
            <li>Come back to this page and click "Check Firebase Auth" to verify authentication</li>
            <li>Click "List Strawberry Plants" to see your plants</li>
            <li>Click "Regenerate All Strawberry Tasks" to fix the fertilization notifications</li>
        </ol>
        
        <h3>What this does:</h3>
        <ul>
            <li>Finds all your strawberry plants</li>
            <li>Deletes old pending fertilization tasks</li>
            <li>Generates new tasks with the updated protocol (Neptune's Harvest + 9-15-30)</li>
            <li>Tasks will appear on your dashboard after regeneration</li>
        </ul>
    </div>

    <script type="module">
        // Import Firebase from your app
        let db, auth, FirebaseScheduledTaskService, FirebasePlantService;
        
        function showResult(message, type = 'info') {
            const resultDiv = document.getElementById('result');
            resultDiv.style.display = 'block';
            resultDiv.className = `result ${type}`;
            resultDiv.innerHTML = message;
        }
        
        window.checkAuth = async function() {
            try {
                // This would need to access your Firebase instance
                showResult('‚ö†Ô∏è This is a template. To use this, you would need to:<br>' +
                          '1. Import Firebase modules from your app<br>' +
                          '2. Access the FirebaseScheduledTaskService<br>' +
                          '3. Use the browser console instead for now', 'info');
            } catch (error) {
                showResult('‚ùå Error: ' + error.message, 'error');
            }
        };
        
        window.listStrawberryPlants = function() {
            showResult(`
                <h4>üçì Manual Steps to Find Your Strawberry Plants:</h4>
                <p>1. Open browser console (F12)</p>
                <p>2. Go to your dashboard</p>
                <p>3. Run this code to see your plants:</p>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">
// In browser console on your app:
console.log('üå± All plants:', window.plants);
const strawberryPlants = window.plants?.filter(p => 
    p.varietyName?.toLowerCase().includes('strawberry') || 
    p.varietyName?.toLowerCase().includes('albion')
);
console.log('üçì Strawberry plants:', strawberryPlants);
                </pre>
            `, 'info');
        };
        
        window.regenerateAllStrawberryTasks = function() {
            showResult(`
                <h4>üîÑ Manual Task Regeneration Steps:</h4>
                <p>Since the edit form is having issues, here's how to manually regenerate tasks:</p>
                
                <h5>Option 1: Quick Fix via Browser Console</h5>
                <pre style="background: #f5f5f5; padding: 10px; border-radius: 4px; overflow-x: auto;">
// In browser console on your dashboard:
// First, get your user ID and plants
const user = firebase.auth().currentUser;
const strawberryPlants = plants.filter(p => 
    p.varietyName?.toLowerCase().includes('strawberry')
);

// For each strawberry plant, regenerate tasks
for (const plant of strawberryPlants) {
    console.log('Regenerating tasks for:', plant.customName || plant.varietyName);
    
    // This would call the regeneration method
    // FirebasePlantService.regenerateTasksForPlant(plant, user.uid);
}
                </pre>
                
                <h5>Option 2: Alternative via Plant Update</h5>
                <ol>
                    <li>Go to your dashboard</li>
                    <li>For each strawberry plant, try updating it directly:</li>
                    <li>Look for plant cards and click them</li>
                    <li>Try to find an "update" or "refresh" option</li>
                    <li>Or look for a plant management page</li>
                </ol>
                
                <h5>Option 3: Expected Behavior After Fix</h5>
                <p>Once tasks are regenerated, you should see:</p>
                <ul>
                    <li>‚úÖ Neptune's Harvest tasks (weekly, starting day 120)</li>
                    <li>‚úÖ 9-15-30 fertilizer tasks (biweekly, starting day 127)</li>
                    <li>‚úÖ Overdue notifications for 133+ day plants</li>
                </ul>
            `, 'info');
        };
    </script>
</body>
</html>